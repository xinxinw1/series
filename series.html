<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Series Generator</title>
<script src="lib/tools/tools.js"></script>
<script src="lib/prec-math/prec-math.js"></script>

</head>

<body>
<div id="out"></div>
<script>
function sum(fr, to, f){
  var s = "0";
  for (var i = Number(fr); i <= Number(to); i++){
    s = R.add(s, f(String(i)));
  }
  return s;
}

function udfp(a){
  return a === undefined;
}

// memoize
function his(f){
  var r = [];
  return function (a){
    if (udfp(r[a])){
      r[a] = f(a);
      return r[a];
    }
    return r[a];
  }
}

function his2(f){
  var r = [];
  return function (a, b){
    if (udfp(r[a])){
      r[a] = [];
      r[a][b] = f(a, b);
      return r[a][b];
    }
    if (udfp(r[a][b])){
      r[a][b] = f(a, b);
      return r[a][b];
    }
    return r[a][b];
  }
}

R.bin = his2(R.bin);

function arrof(n, m){
  var r = [];
  for (var i = Number(n); i <= Number(m); i++){
    r.push(String(i));
  }
  return r;
}

function gen(f, nm, n){
  var s = nm + "\\left(x\\right)=";
  if (Number(n) >= 0){
    s += "\\frac{" + f("0") + "}{0!}";
    for (var i = 1; i <= Number(n); i++){
      s += "+\\frac{" + f(String(i)) + "}{" + i + "!}x^{" + i + "}";
    }
  }
  return s;
}

var fst = true;
function out(a){
  if (fst){
    $("out").innerHTML = a;
    fst = false;
  } else {
    $("out").innerHTML += "<br><br>" + a;
  }
}

function eq1(){
  // y''=e^x*y
  function r(n){
    if (n == "0")return "1";
    if (n == "1")return "0";
    var n2 = R.sub(n, "2");
    return sum("0", n2, function (k){
      return R.mul(R.bin(n2, k), r(R.sub(n2, k)));
    });
  }

  function g(n){
    if (n == "0")return "0";
    if (n == "1")return "1";
    var n2 = R.sub(n, "2");
    return sum("0", n2, function (k){
      return R.mul(R.bin(n2, k), g(R.sub(n2, k)));
    });
  }
  
  r = his(r);
  g = his(g);

  function genr(n){
    return gen(r, "f", n);
  }

  function geng(n){
    return gen(g, "g", n);
  }

  //out($.dsp($.map(g, arrof("0", "100"))));
  //genr("100")
  out(genr("100"));
  out(geng("100"));
}

function eq2(){
  // y'' = (y')^2 + y
  
  var a0 = "0";
  var a1 = "1";
  
  function p(n){
    if (n == "0")return a0;
    if (n == "1")return a1;
    var n2 = R.sub(n, "2");
    var s1 = p(n2);
    var s2 = sum("0", n2, function (k){
      var k1 = R.add(k, "1");
      return R.mul(R.bin(n2, k), R.mul(p(k1), p(R.sub(n, k1))));
    });
    return R.add(s1, s2);
  }
  
  function genp(n){
    return gen(p, "f", n);
  }
  
  p = his(p);
  
  //$.al($.map(p, arrof("0", "20")));
  out(genp("100"));
}

function eq3(){
  // y''+2y'+y=sin(x)
  
  function d(n){
    if (n == "0")return "0";
    if (n == "1")return "0";
    var s = "0";
    switch (Number(n) % 4){
      case 1: s = "-1"; break;
      case 3: s = "1"; break;
    }
    var d1 = d(R.sub(n, "1"));
    var d2 = d(R.sub(n, "2"))
    return R.sub(s, R.mul("2", R.add(d1, d2)));
  }
  
  function gend(n){
    return gen(d, "f", n);
  }
  
  d = his(d);
  
  //$.al($.map(p, arrof("0", "20")));
  out(gend("100"));
}

//eq1();
//eq2();
eq3();

</script>
</body>

</html> 
